@{
    Business.Platform.Dictionary BDictionary = new Business.Platform.Dictionary();
    Business.Platform.Users BUsers = new Business.Platform.Users();
    
    List<Data.Model.Dictionary> lstdic=new List<Data.Model.Dictionary> ();
    lstdic=BDictionary.GetAllChilds("a4c6a246-64c8-4441-8852-0357120921fb".ToGuid(),false);

    List<Data.Model.Users> lstusers = new List<Data.Model.Users>();
    lstusers = BUsers.GetAll();
   // lstusers = lstusers.FindAll(p=>p.Status==0);
    
    string id = Request.QueryString["instanceid"];
    string title = string.Empty;
    string contents = string.Empty;
    string sql = "SELECT * FROM dbo.EffectTimer";
    
    System.Data.DataTable dt = new Data.MSSQL.DBHelper().GetDataTable(sql);
    System.Data.DataView dv = dt.DefaultView;
    System.Data.DataView dvfind = dv;
    //if (id.IsInt())
    //{
    //    string sql = "SELECT * FROM dbo.EffectTimer WHERE ID=" + id;
    //    System.Data.DataTable dt = new Data.MSSQL.DBHelper().GetDataTable(sql);
    //    if (dt.Rows.Count > 0)
    //    {
    //        title = dt.Rows[0]["Title"].ToString();
    //        contents = dt.Rows[0]["Contents"].ToString();
    //    }
    //}
}
<br /><br /><br />
<!--任务标题字段-->

<div style="text-align:center; font-size:24px; font-weight:bold;">窗口业务时效采集</div>
<br />
<table cellpadding="0" cellspacing="1" border="0" width="99%" class="formtable" align="center">
    
        
    <tr>

        <th style="width: 80px; text-align: center;">
            操作业务类型
        </th>
        @{
            foreach (var user in lstusers.FindAll(p => p.Name == "顾莉莉" || p.Name == "邓竹君" || p.Name == "王珏" || p.Name == "郑炜巍" || p.Name == "曹燕莉" || p.Name == "张玉婷" || p.Name == "刘振巍" || p.Name == "丁美萍" || p.Name == "诸李斌" || p.Name == "唐宁" || p.Name == "黄伟" || p.Name == "陆国民" || p.Name == "黄丽敏"))
                         {
            <th style="width: 80px; text-align: center;">
                  @user.Name
                </th>
            }
            
 
        }
    </tr>
            
            
         @{
             for (int j = 0; j < lstdic.Count; j++)        
             {
                 <tr>
                     <td>@BDictionary.Get(lstdic[j].ID, false).Title</td>
                     @{
                
                 foreach (var user in lstusers.FindAll(p => p.Name == "顾莉莉" || p.Name == "邓竹君" || p.Name == "王珏" || p.Name == "郑炜巍" || p.Name == "曹燕莉" || p.Name == "张玉婷" || p.Name == "刘振巍" || p.Name == "丁美萍" || p.Name == "诸李斌" || p.Name == "唐宁" || p.Name == "黄伟" || p.Name == "陆国民" || p.Name == "黄丽敏"))
                         {
                             TimeSpan ts = new TimeSpan();
                             double total = 0;
                             if (user.Name == "顾莉莉")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "邓竹君")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "王珏")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "郑炜巍")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }


                             if (user.Name == "曹燕莉")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }



                             if (user.Name == "张玉婷")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }


                             if (user.Name == "刘振巍")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }
                             
                             
                             if (user.Name == "丁美萍")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "诸李斌")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "唐宁")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "黄伟")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "陆国民")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@((total / dv.Count) / 60)</td>
                                 }

                             }

                             if (user.Name == "黄丽敏")
                             {
                                 dv.RowFilter = "UserID='" + "u_" + user.ID + "' and BunessType='" + lstdic[j].ID.ToString() + "'";
                                 for (int i = 0; i < dv.Count; i++)
                                 {


                                     ts = Convert.ToDateTime(dv[i]["EndTime"].ToString()) - Convert.ToDateTime(dv[i]["StartTime"].ToString());
                                     total = total + ts.TotalSeconds;
                                     
                                 }
                                 if (dv.Count == 0)
                                 {
                                     <td>0</td>
                                 }
                                 else
                                 { 
                                 <td>@(Math.Round((total / dv.Count)/60,2))</td>
                                 }
                                 
                             }
                             
                            
                            
                             
                             
                         }
                         
                     }
                 </tr>
             }
             
         }   
        
       
</table>
@{
	string FlowID = Request.QueryString["flowid"];
	string StepID = Request.QueryString["stepid"];
	string GroupID = Request.QueryString["groupid"];
	string TaskID = Request.QueryString["taskid"];
	string InstanceID = Request.QueryString["instanceid"];
	string DisplayModel = Request.QueryString["display"] ?? "0";
	string DBConnID = "06075250-30dc-4d32-bf97-e922cb30fac8";
	string DBTable = "TempTest_CustomForm";
	string DBTablePK = "ID";
	string DBTableTitle = "VisitName";
	Business.Platform.Dictionary BDictionary = new Business.Platform.Dictionary();
	Business.Platform.WorkFlow BWorkFlow = new Business.Platform.WorkFlow();
	Business.Platform.WorkFlowTask BWorkFlowTask = new Business.Platform.WorkFlowTask();
	string fieldStatus = BWorkFlow.GetFieldStatus(FlowID, StepID);
	LitJson.JsonData initData = BWorkFlow.GetFormData(DBConnID, DBTable, DBTablePK, InstanceID, fieldStatus);
    string TaskTitle = BWorkFlow.GetFromFieldData(initData, DBTable, DBTableTitle);
    string monthcode = string.Empty;
    string yearcode = string.Empty;
    string sql = "SELECT * FROM TempTest_CustomForm where year(VisitDate)='{0}' and month(VisitDate)='{1}'";
    sql = string.Format(sql, System.DateTime.Now.Year.ToString(),System.DateTime.Now.Month.ToString());
    System.Data.DataTable dt = new Data.MSSQL.DBHelper().GetDataTable(sql);
    if (dt.Rows.Count > 0)
    {
        monthcode = (dt.Rows.Count + 1).ToString();
        monthcode = monthcode.PadLeft(4,'0');
    }
    else
    {
        monthcode = "0001";
    }

    string sqlyear = "SELECT * FROM TempTest_CustomForm where year(VisitDate)='{0}'";
    sqlyear = string.Format(sqlyear, System.DateTime.Now.Year.ToString());
    System.Data.DataTable dtyear = new Data.MSSQL.DBHelper().GetDataTable(sqlyear);
    if (dtyear.Rows.Count > 0)
    {
        yearcode = (dtyear.Rows.Count + 1).ToString();
        yearcode = yearcode.PadLeft(4, '0');
    }
    else
    {
        yearcode = "0001";
    }


    string visitcode = "(市、区县) 闵" + System.DateTime.Now.Year.ToString() + System.DateTime.Now.Month.ToString() + monthcode + "第" + yearcode + "号";
}
<link href="~/Scripts/FlowRun/Forms/flowform.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/FlowRun/Forms/common.js" type="text/javascript" ></script>
<script src="~/Scripts/Ueditor/ueditor.config.js" type="text/javascript" ></script>
<script src="~/Scripts/Ueditor/ueditor.all.min.js" type="text/javascript" ></script>
<script src="~/Scripts/Ueditor/lang/zh-cn/zh-cn.js" type="text/javascript" ></script>
<input type="hidden" id="Form_HasUEditor" name="Form_HasUEditor" value="1" />
<input type="hidden" id="Form_ValidateAlertType" name="Form_ValidateAlertType" value="1" />
<input type="hidden" id="Form_TitleField" name="Form_TitleField" value="TempTest_CustomForm.VisitName" />
<input type="hidden" id="Form_DBConnID" name="Form_DBConnID" value="06075250-30dc-4d32-bf97-e922cb30fac8" />
<input type="hidden" id="Form_DBTable" name="Form_DBTable" value="TempTest_CustomForm" />
<input type="hidden" id="Form_DBTablePk" name="Form_DBTablePk" value="ID" />
<input type="hidden" id="Form_DBTableTitle" name="Form_DBTableTitle" value="VisitName" />
<input type="hidden" id="Form_AutoSaveData" name="Form_AutoSaveData" value="1" />
<script type="text/javascript">
	var initData = @Html.Raw(BWorkFlow.GetFormDataJsonString(initData));
	var fieldStatus = @Html.Raw(fieldStatus);
	var displayModel = '@DisplayModel';
	$(function (){
		formrun.initData(initData, "TempTest_CustomForm", fieldStatus, displayModel);
	});
</script>
<p> </p><p> </p><p style="text-align: center;"><strong><span style="font-size: 20px;">信访登记</span></strong></p><p>  来访日期：<input name="TempTest_CustomForm.VisitDate" title="" class="mycalendar" id="TempTest_CustomForm.VisitDate" value="@(Utility.DateTimeNew.ShortDate)" istime="0" currentmonth="0" dayafter="0" daybefor="0" defaultvalue="@(Utility.DateTimeNew.ShortDate)" type1="flow_datetime" isflow="1"/>                                                                                        信访编号：<input name="TempTest_CustomForm.VisitCode" title="" class="mytext" id="TempTest_CustomForm.VisitCode" type="text" value="@visitcode" type1="flow_text" isflow="1" valuetype="0" width="310"/><table class="flowformtable" cellspacing="1" cellpadding="0" data-sort="sortDisabled">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <tbody id="printbody">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr class="firstRow"><td width="153" height="16" align="middle" valign="center">来访人姓名<br /></td><td width="166" height="16" valign="top"><input name="TempTest_CustomForm.VisitName" title="" class="mytext" id="TempTest_CustomForm.VisitName" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="30" align="middle" valign="center">性别</td><td width="201" valign="top"><input name="TempTest_CustomForm.VisitSex" title="" class="mytext" id="TempTest_CustomForm.VisitSex" style="width: 50px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="70" align="middle" valign="center">年龄</td><td width="147" valign="top"><input name="TempTest_CustomForm.VisitAge" title="" class="mytext" id="TempTest_CustomForm.VisitAge" style="width: 50px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="114" valign="top">身份证号码</td><td width="155" valign="top"><input name="TempTest_CustomForm.VisitID" title="" class="mytext" id="TempTest_CustomForm.VisitID" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td width="153" height="9" align="middle" valign="center">涉及人姓名<br /></td><td width="166" height="9" valign="top"><input name="TempTest_CustomForm.OtherName" title="" class="mytext" id="TempTest_CustomForm.OtherName" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="41" align="middle" valign="center">性别</td><td width="201" valign="top"><input name="TempTest_CustomForm.OtherSex" title="" class="mytext" id="TempTest_CustomForm.OtherSex" style="width: 50px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="70" align="middle" valign="center">年龄</td><td width="147" valign="top"><input name="TempTest_CustomForm.OtherAge" title="" class="mytext" id="TempTest_CustomForm.OtherAge" style="width: 50px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="83" valign="top">身份证号码</td><td width="155" valign="top"><input name="TempTest_CustomForm.OtherID" title="" class="mytext" id="TempTest_CustomForm.OtherID" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td width="86" align="middle" valign="center">联系地址</td><td width="706" valign="top" colspan="5"><input name="TempTest_CustomForm.Address" title="" class="mytext" id="TempTest_CustomForm.Address" style="width: 350px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="113" valign="top">联系电话</td><td width="151" valign="top"><input name="TempTest_CustomForm.Tel" title="" class="mytext" id="TempTest_CustomForm.Tel" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td width="31" align="middle" valign="center">单位</td><td width="450" valign="top" colspan="3"><input name="TempTest_CustomForm.Unit" title="" class="mytext" id="TempTest_CustomForm.Unit" style="width: 250px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="70" align="middle" valign="center">联系人</td><td width="146" valign="top"><input name="TempTest_CustomForm.ContactName" title="" class="mytext" id="TempTest_CustomForm.ContactName" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td><td width="113" align="middle" valign="center">电话</td><td width="151" valign="top"><input name="TempTest_CustomForm.ContactTel" title="" class="mytext" id="TempTest_CustomForm.ContactTel" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td width="31" align="middle" valign="center">来访情况</td><td width="1008" valign="top" colspan="7">@Html.Raw(BDictionary.GetRadiosByID("5aa2a4fa-6738-4000-aaa8-423f8838919b".ToGuid(), "TempTest_CustomForm.VisitSituation", Business.Platform.Dictionary.OptionValueField.ID, "", "isflow='1' type1='flow_radio'"))</td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td align="middle" valign="center" style="-ms-word-break: break-all;" rowspan="2" colspan="1">来访事项</td><td align="left" valign="middle" style="-ms-word-break: break-all;" rowspan="1" colspan="7"><select name="TempTest_CustomForm.VisitMatters" class="myselect" id="TempTest_CustomForm.VisitMatters" type1="flow_select" isflow="1"><option value=""></option>@Html.Raw(BDictionary.GetOptionsByID("53b3faac-0ae7-4469-a4f2-d306f6c1e24b".ToGuid(), Business.Platform.Dictionary.OptionValueField.ID, ""))</select></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td align="left" valign="middle" style="-ms-word-break: break-all;" rowspan="1" colspan="7">其他备注：<input name="TempTest_CustomForm.VisitMattersRemark" title="" class="mytext" id="TempTest_CustomForm.VisitMattersRemark" style="width: 350px;" value="" type1="flow_text" isflow="1" valuetype="0" /></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td align="middle" valign="center" style="-ms-word-break: break-all;" rowspan="2" colspan="1">来访记录</td><td align="left" valign="middle" style="-ms-word-break: break-all;" rowspan="1" colspan="7">@Html.Raw(BDictionary.GetRadiosByID("858862b4-bc5a-4bb9-b57f-23228f8be632".ToGuid(), "TempTest_CustomForm.VisitRecord", Business.Platform.Dictionary.OptionValueField.ID, "", "isflow='1' type1='flow_radio'"))</td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td align="left" valign="middle" style="-ms-word-break: break-all;" rowspan="1" colspan="7"><textarea name="TempTest_CustomForm.VisitRecordRemark" class="mytext" id="TempTest_CustomForm.VisitRecordRemark" style="width: 431px; height: 66px;" type1="flow_textarea" isflow="1"></textarea></td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <tr><td align="middle" valign="center" style="-ms-word-break: break-all;" rowspan="1" colspan="1">处理结果</td><td align="left" valign="middle" style="-ms-word-break: break-all;" rowspan="1" colspan="7">@Html.Raw(BDictionary.GetCheckboxsByID("c60fb64a-4208-4d80-a5e8-f2e246819d9c".ToGuid(), "TempTest_CustomForm.DealResult", Business.Platform.Dictionary.OptionValueField.ID, "", "isflow='1' type1='flow_checkbox'"))</td></tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </tbody>
    <tbody>
        <tr><td align="middle" valign="center" style="-ms-word-break: break-all;">发票金额</td><td align="left" valign="center" style="-ms-word-break: break-all;" colspan="3"><input name="TempTest_CustomForm.VoiceAccount" title="" class="mytext" id="TempTest_CustomForm.VoiceAccount" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0"/></td><td align="middle" valign="center" style="-ms-word-break: break-all;">发票数量</td><td width="111" align="left" valign="center"><input name="TempTest_CustomForm.VoiceNum" title="" class="mytext" id="TempTest_CustomForm.VoiceNum" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0"/></td><td width="111" align="left" valign="center" style="-ms-word-break: break-all;">复印件发票数</td><td width="111" align="left" valign="center"><input name="TempTest_CustomForm.VoiceCopyNum" title="" class="mytext" id="TempTest_CustomForm.VoiceCopyNum" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0"/></td></tr><tr><td align="middle" valign="center" style="-ms-word-break: break-all;">工作办理周期</td><td align="left" valign="center" colspan="3"><input name="TempTest_CustomForm.WorkDate" title="" class="mytext" id="TempTest_CustomForm.WorkDate" style="width: 120px;" value="" type1="flow_text" isflow="1" valuetype="0"/></td><td align="middle" valign="center" style="-ms-word-break: break-all;">预约办理时间</td><td align="left" valign="center" colspan="3"><input name="TempTest_CustomForm.PreDate" title="" class="mycalendar" id="TempTest_CustomForm.PreDate" style="width: 120px;" value="" istime="0" currentmonth="0" dayafter="0" daybefor="0" defaultvalue="" type1="flow_datetime" isflow="1"/></td></tr><tr><td align="middle" valign="center" style="-ms-word-break: break-all;">诊断</td><td align="left" valign="center" colspan="7"><input name="TempTest_CustomForm.Diagnosis" title="" class="mytext" id="TempTest_CustomForm.Diagnosis" style="width: 436px; height: 22px;" size="22" value="" type1="flow_text" isflow="1" valuetype="0"/></td></tr><tr><td align="middle" valign="center" style="-ms-word-break: break-all;" rowspan="1">来访人员签字</td><td align="left" valign="center" style="-ms-word-break: break-all;" colspan="7"> <textarea name="TempTest_CustomForm.SignFile" class="mytextarea" id="TempTest_CustomForm.SignFile" style="width: 95%; height: 150px;" type1="flow_textarea" isflow="1" model="html">@Html.Raw(BWorkFlow.GetFromFieldData(initData, "TempTest_CustomForm","SignFile"))</textarea></td></tr></tbody></table><p></p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p></p>